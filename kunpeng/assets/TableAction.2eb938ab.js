var mt=Object.defineProperty,ft=Object.defineProperties;var gt=Object.getOwnPropertyDescriptors;var De=Object.getOwnPropertySymbols;var pt=Object.prototype.hasOwnProperty,ht=Object.prototype.propertyIsEnumerable;var Fe=(e,t,n)=>t in e?mt(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,k=(e,t)=>{for(var n in t||(t={}))pt.call(t,n)&&Fe(e,n,t[n]);if(De)for(var n of De(t))ht.call(t,n)&&Fe(e,n,t[n]);return e},N=(e,t)=>ft(e,gt(t));var H=(e,t,n)=>new Promise((o,s)=>{var l=i=>{try{a(n.next(i))}catch(d){s(d)}},r=i=>{try{a(n.throw(i))}catch(d){s(d)}},a=i=>i.done?o(i.value):Promise.resolve(i.value).then(l,r);a((n=n.apply(e,t)).next())});import{bg as _t,bh as bt,P as V,bi as Ct,d as le,s as U,bf as _e,bj as vt,bk as yt,bl as kt,bm as St,e as L,i as He,j as O,bn as ge,q as ie,h as Ue,B as G,u as f,o as z,X as ee,R as b,a as F,Q as _,S as wt,be as X,N as re,ah as Me,ad as je,ar as Et,as as $e,aA as $t,ag as Ot,aO as qe,bo as Oe,$ as Dt,a_ as Ft,aQ as xt,aB as Pt,aH as It,b3 as Lt,bp as Ke,bq as Rt,br as At,bs as xe,bt as Nt,bu as Pe,bv as Tt,bw as Vt,c as Q,w as Ie,v as Le,t as pe,V as te,bx as he,by as zt,f as We,aN as Qe,bz as Bt,bA as Ht,bB as Ut,a6 as me,bC as Mt,r as Ge,bD as jt,bE as qt,F as Xe,p as Kt,b as Wt,aq as Ye,bF as Qt}from"./vendor.192340e4.js";import{S as Gt}from"./sortable.esm.81321d43.js";import{u as Xt}from"./useDesignSetting.0219bcf0.js";import{_ as be,i as Yt,a as de,b as B,c as Se,d as J,e as ae,f as Ze}from"./index.ea60a1e6.js";import{p as we}from"./propTypes.13e00d90.js";import{c as Zt}from"./componentSetting.ed658149.js";import{t as Jt,a as en,u as tn}from"./index.esm.7227c09d.js";const Je=Symbol("s-table");function nn(e){bt(Je,e)}function et(){return _t(Je)}function ye(e){e.parentElement!==null&&e.parentElement.removeChild(e)}function Re(e,t,n){const o=n===0?e.children[0]:e.children[n-1].nextSibling;e.insertBefore(t,o)}function on(){return typeof window!="undefined"?window.console:global.console}const sn=on();function an(e){const t=Object.create(null);return function(o){return t[o]||(t[o]=e(o))}}const ln=/-(\w)/g,rn=an(e=>e.replace(ln,(t,n)=>n.toUpperCase())),tt=["Start","Add","Remove","Update","End"],nt=["Choose","Unchoose","Sort","Filter","Clone"],ot=["Move"],cn=[ot,tt,nt].flatMap(e=>e).map(e=>`on${e}`),Ee={manage:ot,manageAndEmit:tt,emit:nt};function un(e){return cn.indexOf(e)!==-1}const dn=["a","abbr","address","area","article","aside","audio","b","base","bdi","bdo","blockquote","body","br","button","canvas","caption","cite","code","col","colgroup","data","datalist","dd","del","details","dfn","dialog","div","dl","dt","em","embed","fieldset","figcaption","figure","footer","form","h1","h2","h3","h4","h5","h6","head","header","hgroup","hr","html","i","iframe","img","input","ins","kbd","label","legend","li","link","main","map","mark","math","menu","menuitem","meta","meter","nav","noscript","object","ol","optgroup","option","output","p","param","picture","pre","progress","q","rb","rp","rt","rtc","ruby","s","samp","script","section","select","slot","small","source","span","strong","style","sub","summary","sup","svg","table","tbody","td","template","textarea","tfoot","th","thead","time","title","tr","track","u","ul","var","video","wbr"];function mn(e){return dn.includes(e)}function fn(e){return["transition-group","TransitionGroup"].includes(e)}function st(e){return["id","class","role","style"].includes(e)||e.startsWith("data-")||e.startsWith("aria-")||e.startsWith("on")}function it(e){return e.reduce((t,[n,o])=>(t[n]=o,t),{})}function gn({$attrs:e,componentData:t={}}){const n=it(Object.entries(e).filter(([o,s])=>st(o)));return k(k({},n),t)}function pn({$attrs:e,callBackBuilder:t}){const n=it(at(e));Object.entries(t).forEach(([s,l])=>{Ee[s].forEach(r=>{n[`on${r}`]=l(r)})});const o=`[data-draggable]${n.draggable||""}`;return N(k({},n),{draggable:o})}function at(e){return Object.entries(e).filter(([t,n])=>!st(t)).map(([t,n])=>[rn(t),n]).filter(([t,n])=>!un(t))}const Ae=({el:e})=>e,hn=(e,t)=>e.__draggable_context=t,Ne=e=>e.__draggable_context;class _n{constructor({nodes:{header:t,default:n,footer:o},root:s,realList:l}){this.defaultNodes=n,this.children=[...t,...n,...o],this.externalComponent=s.externalComponent,this.rootTransition=s.transition,this.tag=s.tag,this.realList=l}get _isRootComponent(){return this.externalComponent||this.rootTransition}render(t,n){const{tag:o,children:s,_isRootComponent:l}=this;return t(o,n,l?{default:()=>s}:s)}updated(){const{defaultNodes:t,realList:n}=this;t.forEach((o,s)=>{hn(Ae(o),{element:n[s],index:s})})}getUnderlyingVm(t){return Ne(t)}getVmIndexFromDomIndex(t,n){const{defaultNodes:o}=this,{length:s}=o,l=n.children,r=l.item(t);if(r===null)return s;const a=Ne(r);if(a)return a.index;if(s===0)return 0;const i=Ae(o[0]),d=[...l].findIndex(h=>h===i);return t<d?0:s}}function bn(e,t){const n=e[t];return n?n():[]}function Cn({$slots:e,realList:t,getKey:n}){const o=t||[],[s,l]=["header","footer"].map(i=>bn(e,i)),{item:r}=e;if(!r)throw new Error("draggable element must have an item slot");const a=o.flatMap((i,d)=>r({element:i,index:d}).map(h=>(h.key=n(i),h.props=N(k({},h.props||{}),{"data-draggable":!0}),h)));if(a.length!==o.length)throw new Error("Item slot must have only one child");return{header:s,footer:l,default:a}}function vn(e){const t=fn(e),n=!mn(e)&&!t;return{transition:t,externalComponent:n,tag:n?V(e):t?Ct:e}}function yn({$slots:e,tag:t,realList:n,getKey:o}){const s=Cn({$slots:e,realList:n,getKey:o}),l=vn(t);return new _n({nodes:s,root:l,realList:n})}function lt(e,t){_e(()=>this.$emit(e.toLowerCase(),t))}function rt(e){return(t,n)=>{if(this.realList!==null)return this[`onDrag${e}`](t,n)}}function kn(e){const t=rt.call(this,e);return(n,o)=>{t.call(this,n,o),lt.call(this,e,n)}}let ke=null;const Sn={list:{type:Array,required:!1,default:null},modelValue:{type:Array,required:!1,default:null},itemKey:{type:[String,Function],required:!0},clone:{type:Function,default:e=>e},tag:{type:String,default:"div"},move:{type:Function,default:null},componentData:{type:Object,required:!1,default:null}},wn=["update:modelValue","change",...[...Ee.manageAndEmit,...Ee.emit].map(e=>e.toLowerCase())],En=le({name:"draggable",inheritAttrs:!1,props:Sn,emits:wn,data(){return{error:!1}},render(){try{this.error=!1;const{$slots:e,$attrs:t,tag:n,componentData:o,realList:s,getKey:l}=this,r=yn({$slots:e,tag:n,realList:s,getKey:l});this.componentStructure=r;const a=gn({$attrs:t,componentData:o});return r.render(U,a)}catch(e){return this.error=!0,U("pre",{style:{color:"red"}},e.stack)}},created(){this.list!==null&&this.modelValue!==null&&sn.error("modelValue and list props are mutually exclusive! Please set one or another.")},mounted(){if(this.error)return;const{$attrs:e,$el:t,componentStructure:n}=this;n.updated();const o=pn({$attrs:e,callBackBuilder:{manageAndEmit:l=>kn.call(this,l),emit:l=>lt.bind(this,l),manage:l=>rt.call(this,l)}}),s=t.nodeType===1?t:t.parentElement;this._sortable=new Gt(s,o),this.targetDomElement=s,s.__draggable_component__=this},updated(){this.componentStructure.updated()},beforeUnmount(){this._sortable!==void 0&&this._sortable.destroy()},computed:{realList(){const{list:e}=this;return e||this.modelValue},getKey(){const{itemKey:e}=this;return typeof e=="function"?e:t=>t[e]}},watch:{$attrs:{handler(e){const{_sortable:t}=this;!t||at(e).forEach(([n,o])=>{t.option(n,o)})},deep:!0}},methods:{getUnderlyingVm(e){return this.componentStructure.getUnderlyingVm(e)||null},getUnderlyingPotencialDraggableComponent(e){return e.__draggable_component__},emitChanges(e){_e(()=>this.$emit("change",e))},alterList(e){if(this.list){e(this.list);return}const t=[...this.modelValue];e(t),this.$emit("update:modelValue",t)},spliceList(){const e=t=>t.splice(...arguments);this.alterList(e)},updatePosition(e,t){const n=o=>o.splice(t,0,o.splice(e,1)[0]);this.alterList(n)},getRelatedContextFromMoveEvent({to:e,related:t}){const n=this.getUnderlyingPotencialDraggableComponent(e);if(!n)return{component:n};const o=n.realList,s={list:o,component:n};if(e!==t&&o){const l=n.getUnderlyingVm(t)||{};return k(k({},l),s)}return s},getVmIndexFromDomIndex(e){return this.componentStructure.getVmIndexFromDomIndex(e,this.targetDomElement)},onDragStart(e){this.context=this.getUnderlyingVm(e.item),e.item._underlying_vm_=this.clone(this.context.element),ke=e.item},onDragAdd(e){const t=e.item._underlying_vm_;if(t===void 0)return;ye(e.item);const n=this.getVmIndexFromDomIndex(e.newIndex);this.spliceList(n,0,t);const o={element:t,newIndex:n};this.emitChanges({added:o})},onDragRemove(e){if(Re(this.$el,e.item,e.oldIndex),e.pullMode==="clone"){ye(e.clone);return}const{index:t,element:n}=this.context;this.spliceList(t,1);const o={element:n,oldIndex:t};this.emitChanges({removed:o})},onDragUpdate(e){ye(e.item),Re(e.from,e.item,e.oldIndex);const t=this.context.index,n=this.getVmIndexFromDomIndex(e.newIndex);this.updatePosition(t,n);const o={element:this.context.element,oldIndex:t,newIndex:n};this.emitChanges({moved:o})},computeFutureIndex(e,t){if(!e.element)return 0;const n=[...t.to.children].filter(r=>r.style.display!=="none"),o=n.indexOf(t.related),s=e.component.getVmIndexFromDomIndex(o);return n.indexOf(ke)!==-1||!t.willInsertAfter?s:s+1},onDragMove(e,t){const{move:n,realList:o}=this;if(!n||!o)return!0;const s=this.getRelatedContextFromMoveEvent(e),l=this.computeFutureIndex(s,e),r=N(k({},this.context),{futureIndex:l}),a=N(k({},e),{relatedContext:s,draggedContext:r});return n(a,t)},onDragEnd(){ke=null}}});const $n=le({name:"ColumnSetting",components:{SettingOutlined:vt,DragOutlined:yt,Draggable:En,VerticalRightOutlined:kt,VerticalLeftOutlined:St},setup(){const{getDarkTheme:e}=Xt(),t=et(),n=L([]),o=L([]),s=He({selection:!1,checkAll:!0,checkList:[],defaultCheckList:[]}),l=O(()=>s.selection);ge(()=>{t.getColumns().length&&r()});function r(){const m=d(),g=m.map($=>$.key);s.checkList=g,s.defaultCheckList=g;const C=m.filter($=>$.key!="action"&&$.title!="\u64CD\u4F5C");n.value.length||(n.value=ie(C),o.value=ie(C))}function a(m){s.selection&&m.unshift("selection"),i(m)}function i(m){t.setColumns(m)}function d(){let m=[];return t.getColumns().forEach(g=>{m.push(k({},g))}),m}function h(){s.checkList=[...s.defaultCheckList],s.checkAll=!0;let g=t.getCacheColumns().map(C=>N(k({},C),{fixed:void 0}));i(g),n.value=g}function D(m){let g=t.getCacheColumns(!0);m?(i(g),s.checkList=g):(i([]),s.checkList=[])}function x(){const m=G(f(n));n.value=m,i(m)}function p(m){let g=t.getCacheColumns();m?(g.unshift({type:"selection",key:"selection"}),i(g)):(g.splice(0,1),i(g))}function u(m,g){if(!s.checkList.includes(m.key))return;let C=d();const $=m.fixed===g?void 0:g;let w=C.findIndex(T=>T.key===m.key);w!==-1&&(C[w].fixed=$),t.setCacheColumnsField(m.key,{fixed:$}),n.value[w].fixed=$,i(C)}return N(k({},Ue(s)),{columnsList:n,getDarkTheme:e,onChange:a,onCheckAll:D,onSelection:p,resetColumns:h,fixedColumn:u,draggableEnd:x,getSelection:l})}}),On={class:"cursor-pointer table-toolbar-right-icon"},Dn={class:"table-toolbar-inner-popover-title"},Fn=X("\u5217\u5C55\u793A"),xn=X("\u52FE\u9009\u5217"),Pn=X("\u91CD\u7F6E"),In={class:"table-toolbar-inner"},Ln={class:"drag-icon"},Rn={class:"fixed-item"},An=F("span",null,"\u56FA\u5B9A\u5230\u5DE6\u4FA7",-1),Nn=F("span",null,"\u56FA\u5B9A\u5230\u53F3\u4FA7",-1),Tn=F("span",null,"\u5217\u8BBE\u7F6E",-1);function Vn(e,t,n,o,s,l){const r=V("SettingOutlined"),a=re,i=Me,d=je,h=Et,D=V("DragOutlined"),x=V("VerticalRightOutlined"),p=$e,u=$t,m=V("VerticalLeftOutlined"),g=V("Draggable"),C=Ot,$=qe;return z(),ee(p,{trigger:"hover"},{trigger:b(()=>[F("div",On,[_($,{trigger:"click",width:230,class:"toolbar-popover",placement:"bottom-end"},{trigger:b(()=>[_(a,{size:"18"},{default:b(()=>[_(r)]),_:1})]),header:b(()=>[F("div",Dn,[_(h,null,{default:b(()=>[_(i,{checked:e.checkAll,"onUpdate:checked":[t[0]||(t[0]=w=>e.checkAll=w),e.onCheckAll]},{default:b(()=>[Fn]),_:1},8,["checked","onUpdate:checked"]),_(i,{checked:e.selection,"onUpdate:checked":[t[1]||(t[1]=w=>e.selection=w),e.onSelection]},{default:b(()=>[xn]),_:1},8,["checked","onUpdate:checked"]),_(d,{text:"",type:"info",size:"small",class:"mt-1",onClick:e.resetColumns},{default:b(()=>[Pn]),_:1},8,["onClick"])]),_:1})])]),default:b(()=>[F("div",In,[_(C,{value:e.checkList,"onUpdate:value":[t[3]||(t[3]=w=>e.checkList=w),e.onChange]},{default:b(()=>[_(g,{modelValue:e.columnsList,"onUpdate:modelValue":t[2]||(t[2]=w=>e.columnsList=w),animation:"300","item-key":"key",onEnd:e.draggableEnd},{item:b(({element:w})=>[F("div",{class:wt(["table-toolbar-inner-checkbox",{"table-toolbar-inner-checkbox-dark":e.getDarkTheme===!0}])},[F("span",Ln,[_(a,{size:"18"},{default:b(()=>[_(D)]),_:1})]),_(i,{value:w.key,label:w.title},null,8,["value","label"]),F("div",Rn,[_(p,{trigger:"hover",placement:"bottom"},{trigger:b(()=>[_(a,{size:"18",color:w.fixed==="left"?"#2080f0":void 0,class:"cursor-pointer",onClick:T=>e.fixedColumn(w,"left")},{default:b(()=>[_(x)]),_:2},1032,["color","onClick"])]),default:b(()=>[An]),_:2},1024),_(u,{vertical:""}),_(p,{trigger:"hover",placement:"bottom"},{trigger:b(()=>[_(a,{size:"18",color:w.fixed==="right"?"#2080f0":void 0,class:"cursor-pointer",onClick:T=>e.fixedColumn(w,"right")},{default:b(()=>[_(m)]),_:2},1032,["color","onClick"])]),default:b(()=>[Nn]),_:2},1024)])],2)]),_:1},8,["modelValue","onEnd"])]),_:1},8,["value","onUpdate:value"])])]),_:1})])]),default:b(()=>[Tn]),_:1})}var ct=be($n,[["render",Vn]]);function zn(e){const t=L(f(e).loading);Oe(()=>f(e).loading,s=>{t.value=s});const n=O(()=>f(t));function o(s){t.value=s}return{getLoading:n,setLoading:o}}var ut=(e=>(e.NInput="on-input",e.NInputNumber="on-input",e.NSelect="on-update:value",e.NSwitch="on-update:value",e.NCheckbox="on-update:value",e.NDatePicker="on-update:value",e.NTimePicker="on-update:value",e))(ut||{});const W=new Map;W.set("NInput",Dt);W.set("NInputNumber",Ft);W.set("NSelect",xt);W.set("NSwitch",Pt);W.set("NCheckbox",Me);W.set("NDatePicker",It);W.set("NTimePicker",Lt);const Bn=({component:e="NInput",rule:t=!0,ruleMessage:n,popoverVisible:o},{attrs:s})=>{const l=W.get(e),r=U(l,s);return t?U(qe,{"display-directive":"show",show:!!o,manual:"manual"},{trigger:()=>r,default:()=>U("span",{style:{color:"red",width:"90px",display:"inline-block"}},{default:()=>n})}):r};function Hn(e){return!e||!e.getBoundingClientRect?0:e.getBoundingClientRect()}function Un(e){const t=document.documentElement,n=t.scrollLeft,o=t.scrollTop,s=t.clientLeft,l=t.clientTop,r=window.pageXOffset,a=window.pageYOffset,i=Hn(e),{left:d,top:h,width:D,height:x}=i,p=(r||n)-(s||0),u=(a||o)-(l||0),m=d+r,g=h+a,C=m-p,$=g-u,w=window.document.documentElement.clientWidth,T=window.document.documentElement.clientHeight;return{left:C,top:$,right:w-D-C,bottom:T-x-$,rightIncludeBody:w-C,bottomIncludeBody:T-$}}function Te(e,t,n){e&&t&&n&&e.addEventListener(t,n,!1)}const fe=new Map;let Ve;Yt||(Te(document,"mousedown",e=>Ve=e),Te(document,"mouseup",e=>{for(const{documentHandler:t}of fe.values())t(e,Ve)}));function ze(e,t){let n=[];return Array.isArray(t.arg)?n=t.arg:n.push(t.arg),function(o,s){const l=t.instance.popperRef,r=o.target,a=s.target,i=!t||!t.instance,d=!r||!a,h=e.contains(r)||e.contains(a),D=e===r,x=n.length&&n.some(u=>u==null?void 0:u.contains(r))||n.length&&n.includes(a),p=l&&(l.contains(r)||l.contains(a));i||d||h||D||x||p||t.value()}}const Mn={beforeMount(e,t){fe.set(e,{documentHandler:ze(e,t),bindingFn:t.value})},updated(e,t){fe.set(e,{documentHandler:ze(e,t),bindingFn:t.value})},unmounted(e){fe.delete(e)}};function Be(e){return e==="NInput"?"\u8BF7\u8F93\u5165":["NPicker","NSelect","NCheckbox","NRadio","NSwitch","NDatePicker","NTimePicker"].includes(e)?"\u8BF7\u9009\u62E9":""}const jn=le({name:"EditableCell",components:{FormOutlined:Ke,CloseOutlined:Rt,CheckOutlined:At,CellComponent:Bn},directives:{clickOutside:Mn},props:{value:{type:[String,Number,Boolean,Object],default:""},record:{type:Object},column:{type:Object,default:()=>({})},index:we.number},setup(e){const t=et(),n=L(!1),o=L(),s=L(!1),l=L(""),r=L([]),a=L(e.value),i=L(e.value),d=O(()=>{var c;return((c=e.column)==null?void 0:c.editComponent)||"NInput"}),h=O(()=>{var c;return(c=e.column)==null?void 0:c.editRule}),D=O(()=>f(l)&&f(s)),x=O(()=>{const c=f(d);return["NCheckbox","NRadio"].includes(c)}),p=O(()=>{var K,Y,ce,Z;const c=(Y=(K=e.column)==null?void 0:K.editComponentProps)!=null?Y:{},v=(Z=(ce=e.column)==null?void 0:ce.editComponent)!=null?Z:null,y=f(d),P={},E=f(x);let A=E?"checked":"value";const R=f(a);let S=E?de(R)&&B(R)?R:!!R:R;y==="NDatePicker"&&(Se(S)?c.valueFormat?A="formatted-value":S=xe(S).getTime():J(S)&&(c.valueFormat?A="formatted-value":S=S.map(Ce=>xe(Ce).getTime())));const I=v?ut[v]:void 0;return N(k(k({placeholder:Be(f(d))},P),Nt(c,"onChange")),{[I]:$,[A]:S})}),u=O(()=>{var R,S;const{editComponentProps:c,editValueMap:v}=e.column,y=f(a);if(v&&ae(v))return v(y);if(!f(d).includes("NSelect"))return y;const A=((R=c==null?void 0:c.options)!=null?R:f(r)||[]).find(I=>`${I.value}`==`${y}`);return(S=A==null?void 0:A.label)!=null?S:y}),m=O(()=>{const{align:c="center"}=e.column;return`edit-cell-align-${c}`}),g=O(()=>{const{editable:c}=e.record||{};return!!c});ge(()=>{i.value=e.value}),ge(()=>{const{editable:c}=e.column;(B(c)||B(f(g)))&&(n.value=!!c||f(g))});function C(){var c;f(g)||f((c=e.column)==null?void 0:c.editRow)||(l.value="",n.value=!0,_e(()=>{var y;const v=f(o);(y=v==null?void 0:v.focus)==null||y.call(v)}))}function $(v){return H(this,arguments,function*(c){var A,R,S,I,K;const y=f(d),P=(R=(A=e.column)==null?void 0:A.editComponentProps)!=null?R:{};c?(c==null?void 0:c.target)&&Reflect.has(c.target,"value")?a.value=c.target.value:y==="NCheckbox"?a.value=c.target.checked:(Se(c)||B(c)||de(c))&&(a.value=c):a.value=c,y==="NDatePicker"&&(de(a.value)?P.valueFormat&&(a.value=Pe(a.value,P.valueFormat)):J(a.value)&&P.valueFormat&&(a.value=a.value.map(Y=>{Pe(Y,P.valueFormat)})));const E=(I=(S=e.column)==null?void 0:S.editComponentProps)==null?void 0:I.onChange;E&&ae(E)&&E(...arguments),(K=t.emit)==null||K.call(t,"edit-change",{column:e.column,value:f(a),record:G(e.record)}),yield w()})}function w(){return H(this,null,function*(){const{column:c,record:v}=e,{editRule:y}=c,P=f(a);if(y){if(B(y)&&!P&&!de(P)){s.value=!0;const E=f(d);return l.value=Be(E),!1}if(ae(y)){const E=yield y(P,v);return E?(l.value=E,s.value=!0,!1):(l.value="",!0)}}return l.value="",!0})}function T(c=!0,v=!0){return H(this,null,function*(){var I;if(v&&!(yield w()))return!1;const{column:y,index:P,record:E}=e;if(!E)return!1;const{key:A}=y,R=f(a);if(!A)return;Tt(E,A,R),c&&((I=t.emit)==null||I.call(t,"edit-end",{record:E,index:P,key:A,value:R})),n.value=!1})}function q(){return H(this,null,function*(){var c;((c=e.column)==null?void 0:c.editRow)||(yield T())})}function M(){var E;n.value=!1,a.value=i.value;const{column:c,index:v,record:y}=e,{key:P}=c;s.value=!0,l.value="",(E=t.emit)==null||E.call(t,"edit-cancel",{record:y,index:v,key:P,value:f(a)})}function ne(){var v;if(((v=e.column)==null?void 0:v.editable)||f(g))return;f(d).includes("NInput")&&M()}function oe(c){r.value=c}function j(c,v){var y;e.record&&(J(e.record[c])?(y=e.record[c])==null||y.push(v):e.record[c]=[v])}return e.record&&(j("submitCbs",T),j("validCbs",w),j("cancelCbs",M),e.column.key&&(e.record.editValueRefs||(e.record.editValueRefs={}),e.record.editValueRefs[e.column.key]=a),e.record.onCancelEdit=()=>{var c,v;J((c=e.record)==null?void 0:c.cancelCbs)&&((v=e.record)==null||v.cancelCbs.forEach(y=>y()))},e.record.onSubmitEdit=()=>H(this,null,function*(){var c,v,y,P;if(J((c=e.record)==null?void 0:c.submitCbs)){const E=(((v=e.record)==null?void 0:v.validCbs)||[]).map(I=>I());return(yield Promise.all(E)).every(I=>!!I)?((((y=e.record)==null?void 0:y.submitCbs)||[]).forEach(I=>I(!1,!1)),(P=t.emit)==null||P.call(t,"edit-row-end"),!0):void 0}})),{isEdit:n,handleEdit:C,currentValueRef:a,handleSubmit:T,handleChange:$,handleCancel:M,elRef:o,getComponent:d,getRule:h,onClickOutside:ne,ruleMessage:l,getRuleVisible:D,getComponentProps:p,handleOptionsChange:oe,getWrapperClass:m,getRowEditable:g,getValues:u,handleEnter:q}}}),qn={class:"editable-cell"},Kn={class:"flex editable-cell-content"},Wn={class:"editable-cell-content-comp"},Qn={key:0,class:"editable-cell-action"};function Gn(e,t,n,o,s,l){const r=V("FormOutlined"),a=re,i=V("CellComponent"),d=V("CheckOutlined"),h=V("CloseOutlined"),D=Vt("click-outside");return z(),Q("div",qn,[Ie(F("div",{class:"editable-cell-content",onClick:t[0]||(t[0]=(...x)=>e.handleEdit&&e.handleEdit(...x))},[X(pe(e.getValues)+" ",1),e.column.editRow?te("",!0):(z(),ee(a,{key:0,class:"edit-icon"},{default:b(()=>[_(r)]),_:1}))],512),[[Le,!e.isEdit]]),Ie((z(),Q("div",Kn,[F("div",Wn,[_(i,he(e.getComponentProps,{component:e.getComponent,popoverVisible:e.getRuleVisible,ruleMessage:e.ruleMessage,rule:e.getRule,class:e.getWrapperClass,ref:"elRef",onOptionsChange:e.handleOptionsChange,onPressEnter:e.handleEnter}),null,16,["component","popoverVisible","ruleMessage","rule","class","onOptionsChange","onPressEnter"])]),e.getRowEditable?te("",!0):(z(),Q("div",Qn,[_(a,{class:"mx-2 cursor-pointer"},{default:b(()=>[_(d,{onClick:e.handleSubmit},null,8,["onClick"])]),_:1}),_(a,{class:"mx-2 cursor-pointer"},{default:b(()=>[_(h,{onClick:e.handleCancel},null,8,["onClick"])]),_:1})]))])),[[Le,e.isEdit],[D,e.onClickOutside]])])}var Xn=be(jn,[["render",Gn]]);function Yn(e){return(t,n)=>{const o=e.key,s=t[o];return t.onEdit=(l,r=!1)=>H(this,null,function*(){var a,i;return r||(t.editable=l),!l&&r?(yield(a=t.onSubmitEdit)==null?void 0:a.call(t))?(t.editable=!1,!0):!1:(!l&&!r&&((i=t.onCancelEdit)==null||i.call(t)),!0)}),U(Xn,{value:s,record:t,column:e,index:n})}}function Zn(e){const t=L(f(e).columns);let n=f(e).columns;const o=O(()=>{const p=ie(f(t));return i(e,p),p||[]}),{hasPermission:s}=Ze();function l(p){const u=p.ifShow;let m=!0;return B(u)&&(m=u),ae(u)&&(m=u(p)),m}const r=(p,u)=>U($e,null,{trigger:()=>p,default:()=>u}),a=O(()=>{const p=f(o);return ie(p).filter(m=>s(m.auth)&&l(m)).map(m=>{m.ellipsis=typeof m.ellipsis=="undefined"?{tooltip:!0}:!1;const{edit:g}=m;if(g&&(m.render=Yn(m),g)){const C=m.title;m.title=()=>r(U("span",{},[U("span",{style:{"margin-right":"5px"}},C),U(re,{size:14},{default:()=>U(Ke)})]),"\u8BE5\u5217\u53EF\u7F16\u8F91")}return m})});Oe(()=>f(e).columns,p=>{t.value=p,n=p});function i(p,u){const{actionColumn:m}=f(p);!m||!u.find(g=>g.key==="action")&&u.push(k({},m))}function d(p){const u=ie(p);if(!J(u))return;if(!u.length){t.value=[];return}const m=n.map(g=>g.key);if(!Se(u[0]))t.value=u;else{const g=[];n.forEach(C=>{p.includes(C.key)&&g.push(k({},C))}),zt(m,u)||g.sort((C,$)=>m.indexOf(C.key)-m.indexOf($.key)),t.value=g}}function h(){return G(f(o)).map(u=>N(k({},u),{title:u.title,key:u.key,fixed:u.fixed||void 0}))}function D(p){return p?n.map(u=>u.key):n}function x(p,u){!p||!u||n.forEach(m=>{if(m.key===p){Object.assign(m,u);return}})}return{getColumnsRef:o,getCacheColumns:D,setCacheColumnsField:x,setColumns:d,getColumns:h,getPageColumns:a}}const{table:Jn}=Zt,{apiSetting:eo,defaultPageSize:to,pageSizes:no}=Jn,oo=to,se=eo,so=no;function io(e,{getPaginationInfo:t,setPagination:n,setLoading:o,tableData:s},l){const r=L([]);ge(()=>{s.value=f(r)}),Oe(()=>f(e).dataSource,()=>{const{dataSource:u}=f(e);u&&(r.value=u)},{immediate:!0});const a=O(()=>{const{rowKey:u}=f(e);return u||(()=>"key")}),{isAutoRequest:i=!0}=f(e),d=O(()=>{const u=f(r);return!u||u.length===0?f(r):f(r)});function h(u){return H(this,null,function*(){try{o(!0);const{request:m,pagination:g}=f(e);if(!m)return;const C=se.pageField,$=se.sizeField,w=se.totalField,T=se.listField;let q={};const{page:M=1,size:ne=10}=f(t);B(g)&&!g||B(t)?q={}:(q[C]=u&&u[C]||M,q[$]=ne);const oe=k({},q),j=yield m(oe),c=j[w]||0,v=j[C];c&&M>c&&(n({[C]:c}),h(u));const y=j[T]?j[T]:[];r.value=y,n({[C]:v,[w]:c}),u&&u[C]&&n({[C]:u[C]||1}),l("fetch-success",{items:f(y),resultTotal:c})}catch(m){console.error(m),l("fetch-error",m),r.value=[]}finally{o(!1)}})}We(()=>{i&&setTimeout(()=>{h()},16)});function D(u){r.value=u}function x(){return d.value}function p(u){return H(this,null,function*(){yield h(u)})}return{fetch:h,getRowKey:a,getDataSourceRef:d,getDataSource:x,setTableData:D,reload:p}}function ao(e){const t=L({}),n=L(!0),o=O(()=>{const{pagination:i}=f(e);if(!f(n)||B(i)&&!i)return!1;const{totalField:d}=se;return N(k(k({size:oo,pageSizes:so,showSizePicker:!0,showQuickJumper:!0},B(i)?{}:i),f(t)),{pageCount:f(t)[d]})});function s(i){const d=f(o);t.value=k(k({},B(d)?{}:d),i)}function l(){return f(o)}function r(){return f(n)}function a(i){return H(this,null,function*(){n.value=i})}return{getPagination:l,getPaginationInfo:o,setShowPagination:a,getShowPagination:r,setPagination:s}}const lo=N(k({},Qe.props),{title:{type:String,default:null},titleTooltip:{type:String,default:null},size:{type:String,default:"medium"},dataSource:{type:[Object],default:()=>[]},columns:{type:[Array],default:()=>[],required:!0},request:{type:Function,default:null},rowKey:{type:[String,Function],default:void 0},pagination:{type:[Object,Boolean],default:()=>{}},showPagination:{type:[String,Boolean],default:"auto"},actionColumn:{type:Object,default:null},canResize:we.bool.def(!0),resizeHeightOffset:we.number.def(0),isAutoRequest:{type:Boolean,default:!0}});function ro(e,t=150,n){let o=()=>{e()};o=tn(o,t);const l=()=>{n&&n.immediate&&o(),window.addEventListener("resize",o)},r=()=>{window.removeEventListener("resize",o)};return Jt(()=>{l()}),en(()=>{r()}),[l,r]}const co=[{type:"menu",label:"\u7D27\u51D1",key:"small"},{type:"menu",label:"\u9ED8\u8BA4",key:"medium"},{type:"menu",label:"\u5BBD\u677E",key:"large"}],uo=le({components:{ReloadOutlined:Bt,ColumnHeightOutlined:Ht,ColumnSetting:ct,QuestionCircleOutlined:Ut},props:k({},lo),emits:["fetch-success","fetch-error","update:checked-row-keys","edit-end","edit-cancel","edit-row-end","edit-change"],setup(e,{emit:t}){const n=L(150),o=L(null),s=L(null);let l;const r=L([]),a=L(),i=O(()=>k(k({},e),f(a))),{getLoading:d,setLoading:h}=zn(i),{getPaginationInfo:D,setPagination:x}=ao(i),{getDataSourceRef:p,getDataSource:u,getRowKey:m,reload:g}=io(i,{getPaginationInfo:D,setPagination:x,tableData:r,setLoading:h},t),{getPageColumns:C,setColumns:$,getColumns:w,getCacheColumns:T,setCacheColumnsField:q}=Zn(i),M=He({tableSize:f(i).size||"medium",isColumnSetting:!1});function ne(S){x({page:S}),g()}function oe(S){x({page:1,size:S}),g()}function j(S){M.tableSize=S}const c=O(()=>M.tableSize),v=O(()=>{const S=f(p),I=S.length?`${f(n)}px`:"auto";return N(k({},f(i)),{loading:f(d),columns:G(f(C)),rowKey:f(m),data:S,size:f(c),remote:!0,"max-height":I})}),y=O(()=>G(f(D)));function P(S){a.value=k(k({},f(a)),S)}const E={reload:g,setColumns:$,setLoading:h,setProps:P,getColumns:w,getPageColumns:C,getCacheColumns:T,setCacheColumnsField:q,emit:t},A=O(()=>{const{canResize:S}=f(i);return S});function R(){return H(this,null,function*(){const S=f(o);if(!S||!f(A))return;const I=S==null?void 0:S.$el,K=I.querySelector(".n-data-table-thead "),{bottomIncludeBody:Y}=Un(K),ce=64;let Z=2,Ce=24;B(y)||(l=I.querySelector(".n-data-table__pagination"),l?Z+=l.offsetHeight||0:Z+=28);let ue=Y-(ce+Z+Ce+(e.resizeHeightOffset||0));const ve=e.maxHeight;ue=ve&&ve<ue?ve:ue,n.value=ue})}return ro(R,280),We(()=>{_e(()=>{R()})}),nn(N(k({},E),{wrapRef:s,getBindValues:v})),N(k({},Ue(M)),{tableElRef:o,getBindValues:v,getDataSource:u,densityOptions:co,reload:g,densitySelect:j,updatePage:ne,updatePageSize:oe,pagination:y,tableAction:E})}}),dt=e=>(Kt("data-v-5cfad522"),e=e(),Wt(),e),mo={class:"table-toolbar"},fo={class:"flex items-center table-toolbar-left"},go={key:0,class:"table-toolbar-left-title"},po={class:"flex items-center table-toolbar-right"},ho=dt(()=>F("span",null,"\u5237\u65B0",-1)),_o={class:"table-toolbar-right-icon"},bo=dt(()=>F("span",null,"\u5BC6\u5EA6",-1)),Co={class:"s-table"};function vo(e,t,n,o,s,l){const r=V("QuestionCircleOutlined"),a=re,i=$e,d=V("ReloadOutlined"),h=V("ColumnHeightOutlined"),D=Ye,x=ct,p=Qe;return z(),Q(Xe,null,[F("div",mo,[F("div",fo,[e.title?(z(),Q("div",go,[X(pe(e.title)+" ",1),e.titleTooltip?(z(),ee(i,{key:0,trigger:"hover"},{trigger:b(()=>[_(a,{size:"18",class:"ml-1 text-gray-400 cursor-pointer"},{default:b(()=>[_(r)]),_:1})]),default:b(()=>[X(" "+pe(e.titleTooltip),1)]),_:1})):te("",!0)])):te("",!0),me(e.$slots,"tableTitle",{},void 0,!0)]),F("div",po,[me(e.$slots,"toolbar",{},void 0,!0),_(i,{trigger:"hover"},{trigger:b(()=>[F("div",{class:"table-toolbar-right-icon",onClick:t[0]||(t[0]=(...u)=>e.reload&&e.reload(...u))},[_(a,{size:"18"},{default:b(()=>[_(d)]),_:1})])]),default:b(()=>[ho]),_:1}),_(i,{trigger:"hover"},{trigger:b(()=>[F("div",_o,[_(D,{onSelect:e.densitySelect,trigger:"click",options:e.densityOptions,value:e.tableSize,"onUpdate:value":t[1]||(t[1]=u=>e.tableSize=u)},{default:b(()=>[_(a,{size:"18"},{default:b(()=>[_(h)]),_:1})]),_:1},8,["onSelect","options","value"])])]),default:b(()=>[bo]),_:1}),_(x)])]),F("div",Co,[_(p,he({ref:"tableElRef"},e.getBindValues,{pagination:e.pagination,"onUpdate:page":e.updatePage,"onUpdate:pageSize":e.updatePageSize}),Mt({_:2},[Ge(Object.keys(e.$slots),u=>({name:u,fn:b(m=>[me(e.$slots,u,jt(qt(m)),void 0,!0)])}))]),1040,["pagination","onUpdate:page","onUpdate:pageSize"])])],64)}var No=be(uo,[["render",vo],["__scopeId","data-v-5cfad522"]]);const yo=le({name:"TableAction",components:{DownOutlined:Qt},props:{actions:{type:Array,default:null,required:!0},dropDownActions:{type:Array,default:null},style:{type:String,default:"button"},select:{type:Function,default:()=>{}}},setup(e){const{hasPermission:t}=Ze(),n=e.style==="button"?"default":e.style==="text"?"primary":"default",o=e.style==="button"?void 0:e.style==="text"?!0:void 0,s=O(()=>({text:o,type:n,size:"small"})),l=O(()=>(G(e.dropDownActions)||[]).filter(i=>t(i.auth)&&r(i)).map(i=>{const{popConfirm:d}=i;return N(k(k({size:"small",text:o,type:n},i),d),{onConfirm:d==null?void 0:d.confirm,onCancel:d==null?void 0:d.cancel})}));function r(i){const d=i.ifShow;let h=!0;return B(d)&&(h=d),ae(d)&&(h=d(i)),h}return{getActions:O(()=>(G(e.actions)||[]).filter(i=>t(i.auth)&&r(i)).map(i=>{const{popConfirm:d}=i;return N(k(k({size:"small",text:o,type:n},i),d||{}),{onConfirm:d==null?void 0:d.confirm,onCancel:d==null?void 0:d.cancel,enable:!!d})})),getDropdownList:l,getMoreProps:s}}}),ko={class:"tableAction"},So={class:"flex items-center justify-center"},wo={class:"flex items-center"},Eo=F("span",null,"\u66F4\u591A",-1);function $o(e,t,n,o,s,l){const r=je,a=V("DownOutlined"),i=re,d=Ye;return z(),Q("div",ko,[F("div",So,[(z(!0),Q(Xe,null,Ge(e.getActions,(h,D)=>(z(),ee(r,he({key:`${D}-${h.label}`},h,{class:"mx-2"}),{default:b(()=>[X(pe(h.label),1)]),_:2},1040))),128)),e.dropDownActions&&e.getDropdownList.length?(z(),ee(d,{key:0,trigger:"hover",options:e.getDropdownList,onSelect:e.select},{default:b(()=>[me(e.$slots,"more"),e.$slots.more?te("",!0):(z(),ee(r,he({key:0},e.getMoreProps,{class:"mx-2","icon-placement":"right"}),{default:b(()=>[F("div",wo,[Eo,_(i,{size:"14",class:"ml-1"},{default:b(()=>[_(a)]),_:1})])]),_:1},16))]),_:3},8,["options","onSelect"])):te("",!0)])])}var To=be(yo,[["render",$o]]);export{No as B,To as T};
